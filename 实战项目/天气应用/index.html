<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>全球天气查询</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23fff'/><text x='50' y='70' font-family='Arial' font-size='60' text-anchor='middle' fill='%23000'>⭐️</text></svg>" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div id="app" class="container">
      <header>
        <h1>
          <i class="fas fa-cloud-sun"></i>
          全球天气查询
        </h1>
        <p>实时查询全球城市天气信息</p>
      </header>

      <div class="search-container">
        <input type="text" v-model="searchCity" placeholder="输入城市名称..." @keyup.enter="searchWeather" />
        <button class="location-btn" title="获取当前位置" @click="getLocationWeather">
          <i class="fas fa-location-arrow"></i>
        </button>
        <button @click="searchWeather">
          <i class="fas fa-search"></i>
          搜索
        </button>
      </div>

      <div class="error-message" v-if="errorMessage">{{ errorMessage }}</div>

      <div class="weather-container" v-if="currentWeather">
        <!-- 当前天气显示区域 -->
        <div class="current-weather">
          <div class="weather-main">
            <div class="weather-icon">
              <img :src="weatherIconUrl" alt="天气图标" />
            </div>
            <div class="weather-info">
              <div class="temperature">{{ currentWeather ? currentWeather.temp + '°C' : '--' }}</div>
              <div class="weather-desc">{{ currentWeather ? currentWeather.text : '加载中...' }}</div>
              <div class="location">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ currentLocation || '--' }}</span>
              </div>
            </div>
          </div>

          <div class="weather-details">
            <div class="detail-item" v-for="(detail, index) in weatherDetails" :key="index">
              <i :class="'fas ' + detail.icon"></i>
              <div class="detail-value">{{ detail.value || '--' }}{{ detail.suffix }}</div>
              <div class="detail-label">{{ detail.label }}</div>
            </div>
          </div>
        </div>

        <!-- 天气预报部分 -->
        <div class="forecast-section">
          <h2 class="section-title">
            <i class="fas fa-calendar-alt"></i>
            4天天气预报
          </h2>
          <div class="forecast-container">
            <div class="forecast-card" v-for="(day, index) in forecastData" :key="index">
              <div class="forecast-date">{{ formatDate(day.date) }}</div>
              <div class="forecast-details">
                <div class="forecast-period">
                  <div class="period-title">白天</div>
                  <div class="forecast-icon">
                    <img :src="'https://a.hecdn.net/img/common/icon/202106d/' + getWeatherIconCode(day.dayweather) + '.png'" :alt="day.dayweather" />
                  </div>
                  <div class="forecast-temp">{{ day.daytemp }}°C</div>
                  <div class="forecast-desc">{{ day.dayweather }}</div>
                </div>
                <div class="forecast-period">
                  <div class="period-title">夜间</div>
                  <div class="forecast-icon">
                    <img :src="'https://a.hecdn.net/img/common/icon/202106d/' + getWeatherIconCode(day.nightweather) + '.png'" :alt="day.nightweather" />
                  </div>
                  <div class="forecast-temp">{{ day.nighttemp }}°C</div>
                  <div class="forecast-desc">{{ day.nightweather }}</div>
                </div>
              </div>
              <div class="forecast-summary">
                <div class="temp-range">{{ day.nighttemp }}°C ~ {{ day.daytemp }}°C</div>
                <div class="wind-info">{{ day.daywind || '--' }} {{ day.daypower || '--' }}</div>
              </div>
            </div>
            <div v-if="forecastData.length === 0" class="forecast-placeholder">
              <p>天气预报加载中...</p>
            </div>
          </div>
        </div>

        <!-- 图表容器 -->
        <div class="charts-container">
          <div class="chart-card">
            <h2 class="section-title">
              <i class="fas fa-chart-line"></i>
              温度趋势
            </h2>
            <div class="chart-container">
              <canvas id="tempChart"></canvas>
              <div v-if="chartData.labels.length === 0" class="chart-placeholder">
                <p>温度数据加载中...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- 生活指数部分 -->
        <div class="life-suggestions-section" v-if="lifeSuggestions.length > 0">
          <h2 class="section-title">
            <i class="fas fa-heart"></i>
            生活指数建议
          </h2>
          <div class="suggestions-grid">
            <div class="suggestion-card" v-for="(suggestion, index) in lifeSuggestions" :key="index">
              <div class="suggestion-header">
                <i :class="'fas ' + suggestion.icon"></i>
                <h3>{{ suggestion.label }}</h3>
              </div>
              <div class="suggestion-content">
                <div class="suggestion-brief">{{ suggestion.brief }}</div>
                <div class="suggestion-details">{{ suggestion.details }}</div>
              </div>
            </div>
          </div>
          <div v-if="lifeSuggestions.length === 0" class="suggestions-placeholder">
            <p>生活指数加载中...</p>
          </div>
        </div>
      </div>

      <footer>
        <div class="footer-content">
          <div class="data-source">
            <i class="fas fa-database"></i>
            <span>数据来源: 高德天气API（中国气象局）</span>
          </div>
          <div class="update-info">
            <i class="fas fa-sync-alt"></i>
            <span>更新于: {{ updateTime }}</span>
          </div>
          <div class="api-info">
            <i class="fas fa-info-circle"></i>
            <span>提供4天天气预报，实时天气数据</span>
          </div>
        </div>
      </footer>
    </div>
    <script src="qpp.js"></script>
  </body>
</html>
