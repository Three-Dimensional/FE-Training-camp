<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>全球天气查询</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23fff'/><text x='50' y='70' font-family='Arial' font-size='60' text-anchor='middle' fill='%23000'>⭐️</text></svg>" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a2980, #26d0ce);
        min-height: 100vh;
        padding: 20px;
        color: white;
        transition: background 1s ease;
      }

      body.sunny {
        background: linear-gradient(135deg, #ff9966, #ff5e62);
      }

      body.cloudy {
        background: linear-gradient(135deg, #3a7bd5, #3a6073);
      }

      body.rainy {
        background: linear-gradient(135deg, #1d2b64, #1d3b5c);
      }

      body.night {
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        padding: 20px 0;
        margin-bottom: 30px;
      }

      header h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .search-container {
        max-width: 600px;
        margin: 0 auto 40px;
        display: flex;
        gap: 15px;
        position: relative;
      }

      .search-container input {
        flex: 1;
        padding: 18px 25px;
        border: none;
        border-radius: 50px;
        font-size: 1.1rem;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(5px);
        color: white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .search-container input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .search-container input:focus {
        outline: none;
        background: rgba(255, 255, 255, 0.25);
      }

      .search-container button {
        padding: 0 30px;
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(5px);
        border: none;
        border-radius: 50px;
        color: white;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .search-container button:hover {
        background: rgba(255, 255, 255, 0.35);
        transform: translateY(-2px);
      }

      .location-btn {
        position: absolute;
        right: 150px;
        top: 50%;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        opacity: 0.8;
      }

      .weather-container {
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .current-weather {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .weather-main {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .weather-icon {
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .weather-icon img {
        width: 100%;
        height: auto;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
      }

      .weather-info {
        display: flex;
        flex-direction: column;
      }

      .temperature {
        font-size: 4.5rem;
        font-weight: 300;
        line-height: 300;
        line-height: 1;
      }

      .weather-desc {
        font-size: 1.5rem;
        margin-top: 10px;
      }

      .location {
        font-size: 1.8rem;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .weather-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      .detail-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
      }

      .detail-item i {
        font-size: 2rem;
        margin-bottom: 15px;
      }

      .detail-value {
        font-size: 1.4rem;
        font-weight: 500;
        margin-bottom: 5px;
      }

      .detail-label {
        font-size: 0.95rem;
        opacity: 0.8;
      }

      .forecast-section {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .section-title {
        font-size: 1.8rem;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .forecast-container {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        padding: 10px 5px;
      }

      .forecast-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        min-width: 140px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.3s ease;
      }

      .forecast-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.2);
      }

      .forecast-date {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 15px;
      }

      .forecast-icon {
        width: 70px;
        height: 70px;
        margin-bottom: 15px;
      }

      .forecast-icon img {
        width: 100%;
        height: auto;
      }

      .forecast-temp {
        font-size: 1.4rem;
        font-weight: 500;
        margin-bottom: 5px;
      }

      .forecast-desc {
        font-size: 0.95rem;
        opacity: 0.9;
        text-align: center;
      }

      .charts-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 30px;
      }

      .chart-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .chart-container {
        height: 300px;
        position: relative;
      }

      .loading {
        text-align: center;
        padding: 50px;
        font-size: 1.2rem;
      }

      .error-message {
        background: rgba(231, 76, 60, 0.3);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        margin-top: 20px;
        display: none;
      }

      footer {
        text-align: center;
        padding: 30px 0;
        font-size: 0.9rem;
        opacity: 0.7;
        margin-top: 40px;
      }

      @media (max-width: 768px) {
        .current-weather {
          flex-direction: column;
          align-items: center;
          gap: 30px;
        }

        .weather-main {
          flex-direction: column;
          text-align: center;
        }

        .weather-details {
          grid-template-columns: repeat(2, 1fr);
          max-width: 100%;
        }

        .search-container {
          flex-direction: column;
        }

        .location-btn {
          position: static;
          transform: none;
          margin-top: 15px;
          align-self: center;
        }

        .charts-container {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 480px) {
        .temperature {
          font-size: 3.5rem;
        }

        .weather-details {
          grid-template-columns: 1fr;
        }
      }

      /* 占位符样式 */
      .forecast-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 200px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.1rem;
      }

      .chart-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 300px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.1rem;
      }

      /* 新增样式：改进的天气预报布局 */
      .forecast-details {
        display: flex;
        gap: 20px;
        margin: 15px 0;
      }

      .forecast-period {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
      }

      .period-title {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-bottom: 10px;
        font-weight: 500;
      }

      .forecast-summary {
        text-align: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      .temp-range {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 5px;
      }

      .wind-info {
        font-size: 0.9rem;
        opacity: 0.8;
      }

      /* 改进的页脚样式 */
      .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
      }

      .footer-content > div {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .footer-content i {
        font-size: 1rem;
      }

      /* 改进的天气详情布局 - 已在前文定义，此处移除重复定义 */

      /* 生活指数样式 */
      .life-suggestions-section {
        margin-top: 30px;
      }

      .suggestions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .suggestion-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.18);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .suggestion-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      }

      .suggestion-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
      }

      .suggestion-header i {
        font-size: 1.5rem;
        color: #ff9a8b;
      }

      .suggestion-header h3 {
        font-size: 1.2rem;
        font-weight: 600;
        margin: 0;
      }

      .suggestion-content {
        line-height: 1.6;
      }

      .suggestion-brief {
        font-size: 1.1rem;
        font-weight: 500;
        color: #ff9a8b;
        margin-bottom: 8px;
      }

      .suggestion-details {
        font-size: 0.95rem;
        opacity: 0.9;
        line-height: 1.5;
      }

      .suggestions-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 150px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.1rem;
      }

      /* 响应式调整 */
      @media (max-width: 768px) {
        .forecast-details {
          flex-direction: column;
          gap: 15px;
        }

        .forecast-card {
          min-width: 200px;
        }

        .weather-details {
          grid-template-columns: repeat(2, 1fr);
        }

        .footer-content {
          flex-direction: column;
          text-align: center;
          gap: 15px;
        }

        .suggestions-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .suggestion-card {
          padding: 15px;
        }
      }

      @media (max-width: 480px) {
        .weather-details {
          grid-template-columns: 1fr;
        }

        .forecast-container {
          flex-direction: column;
        }

        .forecast-card {
          min-width: 100%;
        }

        .suggestion-header {
          flex-direction: column;
          text-align: center;
          gap: 8px;
        }

        .suggestion-header h3 {
          font-size: 1.1rem;
        }

        .suggestion-brief {
          font-size: 1rem;
        }

        .suggestion-details {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="app" class="container">
      <header>
        <h1>
          <i class="fas fa-cloud-sun"></i>
          全球天气查询
        </h1>
        <p>实时查询全球城市天气信息</p>
      </header>

      <div class="search-container">
        <input type="text" v-model="searchCity" placeholder="输入城市名称..." @keyup.enter="searchWeather" />
        <button class="location-btn" title="获取当前位置" @click="getLocationWeather">
          <i class="fas fa-location-arrow"></i>
        </button>
        <button @click="searchWeather">
          <i class="fas fa-search"></i>
          搜索
        </button>
      </div>

      <div class="error-message" v-if="errorMessage">{{ errorMessage }}</div>

      <div class="weather-container" v-if="currentWeather">
        <!-- 当前天气显示区域 -->
        <div class="current-weather">
          <div class="weather-main">
            <div class="weather-icon">
              <img :src="weatherIconUrl" alt="天气图标" />
            </div>
            <div class="weather-info">
              <div class="temperature">{{ currentWeather ? currentWeather.temp + '°C' : '--' }}</div>
              <div class="weather-desc">{{ currentWeather ? currentWeather.text : '加载中...' }}</div>
              <div class="location">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ currentLocation || '--' }}</span>
              </div>
            </div>
          </div>

          <div class="weather-details">
            <div class="detail-item" v-for="(detail, index) in weatherDetails" :key="index">
              <i :class="'fas ' + detail.icon"></i>
              <div class="detail-value">{{ detail.value || '--' }}{{ detail.suffix }}</div>
              <div class="detail-label">{{ detail.label }}</div>
            </div>
          </div>
        </div>

        <!-- 天气预报部分 -->
        <div class="forecast-section">
          <h2 class="section-title">
            <i class="fas fa-calendar-alt"></i>
            4天天气预报
          </h2>
          <div class="forecast-container">
            <div class="forecast-card" v-for="(day, index) in forecastData" :key="index">
              <div class="forecast-date">{{ formatDate(day.date) }}</div>
              <div class="forecast-details">
                <div class="forecast-period">
                  <div class="period-title">白天</div>
                  <div class="forecast-icon">
                    <img :src="'https://a.hecdn.net/img/common/icon/202106d/' + getWeatherIconCode(day.dayweather) + '.png'" :alt="day.dayweather" />
                  </div>
                  <div class="forecast-temp">{{ day.daytemp }}°C</div>
                  <div class="forecast-desc">{{ day.dayweather }}</div>
                </div>
                <div class="forecast-period">
                  <div class="period-title">夜间</div>
                  <div class="forecast-icon">
                    <img :src="'https://a.hecdn.net/img/common/icon/202106d/' + getWeatherIconCode(day.nightweather) + '.png'" :alt="day.nightweather" />
                  </div>
                  <div class="forecast-temp">{{ day.nighttemp }}°C</div>
                  <div class="forecast-desc">{{ day.nightweather }}</div>
                </div>
              </div>
              <div class="forecast-summary">
                <div class="temp-range">{{ day.nighttemp }}°C ~ {{ day.daytemp }}°C</div>
                <div class="wind-info">{{ day.daywind || '--' }} {{ day.daypower || '--' }}</div>
              </div>
            </div>
            <div v-if="forecastData.length === 0" class="forecast-placeholder">
              <p>天气预报加载中...</p>
            </div>
          </div>
        </div>

        <!-- 图表容器 -->
        <div class="charts-container">
          <div class="chart-card">
            <h2 class="section-title">
              <i class="fas fa-chart-line"></i>
              温度趋势
            </h2>
            <div class="chart-container">
              <canvas id="tempChart"></canvas>
              <div v-if="chartData.labels.length === 0" class="chart-placeholder">
                <p>温度数据加载中...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- 生活指数部分 -->
        <div class="life-suggestions-section" v-if="lifeSuggestions.length > 0">
          <h2 class="section-title">
            <i class="fas fa-heart"></i>
            生活指数建议
          </h2>
          <div class="suggestions-grid">
            <div class="suggestion-card" v-for="(suggestion, index) in lifeSuggestions" :key="index">
              <div class="suggestion-header">
                <i :class="'fas ' + suggestion.icon"></i>
                <h3>{{ suggestion.label }}</h3>
              </div>
              <div class="suggestion-content">
                <div class="suggestion-brief">{{ suggestion.brief }}</div>
                <div class="suggestion-details">{{ suggestion.details }}</div>
              </div>
            </div>
          </div>
          <div v-if="lifeSuggestions.length === 0" class="suggestions-placeholder">
            <p>生活指数加载中...</p>
          </div>
        </div>
      </div>

      <footer>
        <div class="footer-content">
          <div class="data-source">
            <i class="fas fa-database"></i>
            <span>数据来源: 高德天气API（中国气象局）</span>
          </div>
          <div class="update-info">
            <i class="fas fa-sync-alt"></i>
            <span>更新于: {{ updateTime }}</span>
          </div>
          <div class="api-info">
            <i class="fas fa-info-circle"></i>
            <span>提供4天天气预报，实时天气数据</span>
          </div>
        </div>
      </footer>
    </div>

    <script>
      // Vue2应用实例
      new Vue({
        el: "#app",
        data: {
          // API配置
          API_KEY: "cd6262e8f806b3f73d44d67031d96709", // 高德天气API密钥（需要申请）
          WEATHER_API_URL: "https://restapi.amap.com/v3/weather/weatherInfo",
          // 心知天气生活指数API配置
          SENIVERSE_API_KEY: "SvR5l2gdLKh8X8AmN", // 心知天气API密钥
          SENIVERSE_LIFE_API_URL: "https://api.seniverse.com/v3/life/suggestion.json",
          // 高德天气API支持实时天气和预报，通过extensions参数区分
          // extensions=base: 实时天气
          // extensions=all: 天气预报（3天）

          // 搜索相关
          searchCity: "",
          errorMessage: "",

          // 天气数据
          currentWeather: null,
          currentLocation: "",
          forecastData: [],
          updateTime: "--",

          // 生活指数数据
          lifeSuggestions: [],

          // 图表数据
          chartData: {
            labels: [],
            temps: [],
          },

          // 图表实例
          tempChart: null,
        },
        computed: {
          /**
           * 计算天气图标URL
           */
          weatherIconUrl() {
            if (!this.currentWeather) return ""
            return `https://a.hecdn.net/img/common/icon/202106d/${this.currentWeather.icon}.png`
          },

          /**
           * 天气详情数据
           */
          weatherDetails() {
            if (!this.currentWeather) return []

            return [
              {
                icon: "fa-wind",
                value: this.currentWeather.windSpeed,
                label: "风力",
                suffix: "",
              },
              {
                icon: "fa-tint",
                value: this.currentWeather.humidity,
                label: "湿度",
                suffix: "%",
              },
              {
                icon: "fa-compass",
                value: this.currentWeather.windDirection,
                label: "风向",
                suffix: "",
              },
              {
                icon: "fa-thermometer-half",
                value: this.currentWeather.feelsLike,
                label: "体感温度",
                suffix: "°C",
              },
              {
                icon: "fa-eye",
                value: this.currentWeather.visibility,
                label: "能见度",
                suffix: "km",
              },
              {
                icon: "fa-clock",
                value: this.currentWeather.reportTime,
                label: "更新时间",
                suffix: "",
              },
            ]
          },
        },
        methods: {
          /**
           * 初始化应用，加载默认城市天气
           */
          init() {
            this.fetchWeatherData("北京")
          },

          /**
           * 搜索天气
           */
          searchWeather() {
            const city = this.searchCity.trim()
            if (city) {
              this.fetchWeatherData(city)
            }
          },

          /**
           * 获取位置天气
           */
          getLocationWeather() {
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(
                (position) => {
                  const { latitude, longitude } = position.coords
                  this.fetchWeatherByCoords(latitude, longitude)
                },
                (error) => {
                  this.showError("无法获取您的位置信息")
                }
              )
            } else {
              this.showError("您的浏览器不支持地理位置服务")
            }
          },

          /**
           * 通过坐标获取天气（高德API）
           */
          async fetchWeatherByCoords(lat, lon) {
            try {
              // 高德天气API支持通过坐标查询天气
              // 使用逆地理编码获取城市名称，然后查询天气
              const geoResponse = await fetch(`https://restapi.amap.com/v3/geocode/regeo?key=${this.API_KEY}&location=${lon},${lat}&radius=1000&extensions=base`)
              const geoData = await geoResponse.json()

              if (geoData.status === "1" && geoData.regeocode) {
                const city = geoData.regeocode.addressComponent.city || geoData.regeocode.addressComponent.province
                if (city) {
                  await this.fetchWeatherDataByCity(city)
                } else {
                  this.showError("无法获取该位置的天气信息")
                }
              } else {
                this.showError("无法获取该位置的天气信息")
              }
            } catch (error) {
              this.handleError("获取天气失败", error)
            }
          },

          /**
           * 通过城市名称获取天气
           */
          async fetchWeatherData(city) {
            try {
              // 高德天气API直接使用城市名称查询
              await this.fetchWeatherDataByCity(city)
            } catch (error) {
              this.handleError("获取天气失败", error)
            }
          },

          /**
           * 通过城市名称获取天气数据（高德API）
           */
          async fetchWeatherDataByCity(cityName) {
            try {
              // 获取实时天气
              const currentResponse = await fetch(`${this.WEATHER_API_URL}?key=${this.API_KEY}&city=${cityName}&extensions=base`)
              const currentData = await currentResponse.json()

              if (currentData.status === "1" && currentData.lives.length > 0) {
                this.displayCurrentWeather(currentData, cityName)
                // 获取天气预报
                await this.fetchWeatherForecast(cityName)
                // 获取生活指数
                await this.fetchLifeSuggestion(cityName)
              } else {
                this.showError("城市名称无效或未找到")
              }
            } catch (error) {
              this.handleError("获取天气失败", error)
            }
          },

          /**
           * 获取天气预报（高德API）
           */
          async fetchWeatherForecast(cityName) {
            try {
              const response = await fetch(`${this.WEATHER_API_URL}?key=${this.API_KEY}&city=${cityName}&extensions=all`)
              const data = await response.json()

              if (data.status === "1" && data.forecasts.length > 0) {
                const forecastData = data.forecasts[0]
                // 直接使用高德API数据格式，减少转换步骤
                this.forecastData = forecastData.casts.slice(0, 4)
                this.prepareChartData(data)
              }
            } catch (error) {
              this.handleError("获取预报失败", error)
            }
          },

          /**
           * 获取生活指数（心知天气API）
           */
          async fetchLifeSuggestion(cityName) {
            try {
              // 使用您提供的完整URL，包含正确的API密钥
              const apiUrl = `https://api.seniverse.com/v3/life/suggestion.json?key=SvR5l2gdLKh8X8AmN&location=${encodeURIComponent(cityName)}&language=zh-Hans&days=5`

              const response = await fetch(apiUrl)

              if (!response.ok) {
                throw new Error(`API请求失败: ${response.status}`)
              }

              const data = await response.json()

              if (data.results && data.results.length > 0) {
                const result = data.results[0]
                if (result.suggestion) {
                  // 提取关键的生活指数信息
                  this.lifeSuggestions = this.processLifeSuggestions(result.suggestion)
                  // 强制Vue重新渲染
                  this.$forceUpdate()
                } else {
                  this.lifeSuggestions = this.getMockLifeSuggestions()
                }
              } else {
                this.lifeSuggestions = this.getMockLifeSuggestions()
              }
            } catch (error) {
              this.lifeSuggestions = this.getMockLifeSuggestions()
              this.$forceUpdate()
            }
          },

          /**
           * 处理生活指数数据
           */
          processLifeSuggestions(suggestions) {
            // 检查数据结构：可能是对象而不是数组
            if (!suggestions) {
              return this.getMockLifeSuggestions()
            }

            // 首先尝试直接处理对象结构
            let result = []
            
            // 如果suggestions是对象，尝试提取其中的生活指数
            if (typeof suggestions === 'object' && !Array.isArray(suggestions)) {
              // 定义需要显示的生活指数类型
              const importantTypes = ["dressing", "car_washing", "flu", "sport", "uv", "comfort"]
              
              // 映射生活指数类型到显示信息
              const typeMap = {
                dressing: { label: "穿衣指数", icon: "fa-tshirt" },
                car_washing: { label: "洗车指数", icon: "fa-car" },
                flu: { label: "感冒指数", icon: "fa-head-side-cough" },
                sport: { label: "运动指数", icon: "fa-running" },
                uv: { label: "紫外线指数", icon: "fa-sun" },
                comfort: { label: "舒适度指数", icon: "fa-smile" }
              }
              
              // 遍历对象的所有属性，查找生活指数数据
              for (const [key, value] of Object.entries(suggestions)) {
                // 如果属性名是生活指数类型
                if (importantTypes.includes(key)) {
                  result.push({
                    label: typeMap[key]?.label || key,
                    icon: typeMap[key]?.icon || "fa-info-circle",
                    brief: value?.brief || value?.desc || value?.category || "暂无数据",
                    details: value?.details || value?.info || value?.text || "数据加载中..."
                  })
                }
                // 如果属性值是对象且包含生活指数数据
                else if (value && typeof value === 'object' && value.name && importantTypes.includes(value.name)) {
                  result.push({
                    label: typeMap[value.name]?.label || value.name,
                    icon: typeMap[value.name]?.icon || "fa-info-circle",
                    brief: value.brief || value.desc || value.category || "暂无数据",
                    details: value.details || value.info || value.text || "数据加载中..."
                  })
                }
              }
            }
            // 如果是数组结构，按原逻辑处理
            else if (Array.isArray(suggestions)) {
              // 定义需要显示的生活指数类型
              const importantTypes = ["dressing", "car_washing", "flu", "sport", "uv", "comfort"]
              
              // 映射生活指数类型到显示信息
              const typeMap = {
                dressing: { label: "穿衣指数", icon: "fa-tshirt" },
                car_washing: { label: "洗车指数", icon: "fa-car" },
                flu: { label: "感冒指数", icon: "fa-head-side-cough" },
                sport: { label: "运动指数", icon: "fa-running" },
                uv: { label: "紫外线指数", icon: "fa-sun" },
                comfort: { label: "舒适度指数", icon: "fa-smile" }
              }

              // 过滤出需要显示的生活指数
              result = suggestions
                .filter(suggestion => suggestion && suggestion.name && importantTypes.includes(suggestion.name))
                .map(suggestion => ({
                  label: typeMap[suggestion.name]?.label || suggestion.name,
                  icon: typeMap[suggestion.name]?.icon || "fa-info-circle",
                  brief: suggestion.brief || suggestion.desc || suggestion.category || "暂无数据",
                  details: suggestion.details || suggestion.info || suggestion.text || "数据加载中..."
                }))
            }

            // 如果API返回的数据为空，使用模拟数据
            if (result.length === 0) {
              return this.getMockLifeSuggestions()
            }

            return result
          },

          /**
           * 获取模拟生活指数数据
           */
          getMockLifeSuggestions(cityName) {
            return [
              {
                label: "穿衣指数",
                icon: "fa-tshirt",
                brief: "建议穿着轻薄衣物",
                details: "天气温暖，适合穿着短袖、薄外套等轻薄衣物"
              },
              {
                label: "洗车指数",
                icon: "fa-car",
                brief: "适宜洗车",
                details: "未来24小时无雨，适宜洗车"
              },
              {
                label: "感冒指数",
                icon: "fa-head-side-cough",
                brief: "少发感冒",
                details: "天气条件不易引发感冒，但请注意适当增减衣物"
              },
              {
                label: "运动指数",
                icon: "fa-running",
                brief: "适宜运动",
                details: "天气条件适宜户外运动"
              },
              {
                label: "紫外线指数",
                icon: "fa-sun",
                brief: "中等强度",
                details: "紫外线强度中等，外出时建议涂抹防晒霜"
              },
              {
                label: "舒适度指数",
                icon: "fa-smile",
                brief: "舒适",
                details: "天气条件舒适，适宜外出活动"
              }
            ]
          },

          /**
           * 显示当前天气（高德API）
           */
          displayCurrentWeather(data, cityName) {
            // 高德API实时天气数据在lives数组中
            if (data.lives && data.lives.length > 0) {
              const liveData = data.lives[0]
              this.currentWeather = {
                temp: liveData.temperature, // 温度
                text: liveData.weather, // 天气状况
                icon: this.getWeatherIconCode(liveData.weather), // 天气图标代码
                windSpeed: liveData.windpower, // 风力
                windDirection: liveData.winddirection || "--", // 风向
                humidity: liveData.humidity, // 湿度
                reportTime: this.formatReportTime(liveData.reporttime), // 报告时间
                feelsLike: this.calculateFeelsLike(liveData.temperature, liveData.humidity), // 体感温度
                visibility: liveData.visibility || "--", // 能见度
              }
              this.currentLocation = cityName
              this.updateTime = new Date().toLocaleString("zh-CN")
              this.errorMessage = ""

              // 更新背景样式
              this.updateBackground()
            }
          },

          /**
           * 根据天气状况获取图标代码（高德API适配）
           */
          getWeatherIconCode(weatherText) {
            // 简化处理：根据天气文本映射到和风天气图标代码
            const weather = weatherText.toLowerCase()
            if (weather.includes("晴")) return "100"
            if (weather.includes("云") || weather.includes("阴")) return "101"
            if (weather.includes("雨")) return "305"
            if (weather.includes("雪")) return "399"
            if (weather.includes("雾")) return "501"
            return "999" // 默认
          },

          /**
           * 格式化报告时间
           */
          formatReportTime(reportTime) {
            if (!reportTime) return "--"
            try {
              const date = new Date(reportTime)
              return date.toLocaleString("zh-CN", {
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
              })
            } catch {
              return reportTime
            }
          },

          /**
           * 计算体感温度（简化算法）
           */
          calculateFeelsLike(temp, humidity) {
            if (!temp || !humidity) return "--"
            const temperature = parseInt(temp)
            const hum = parseInt(humidity)

            // 简化的体感温度计算
            if (temperature >= 27) {
              // 高温高湿时体感温度更高
              return Math.round(temperature + (hum / 100) * 2)
            } else if (temperature <= 10) {
              // 低温高湿时体感温度更低
              return Math.round(temperature - (hum / 100) * 1)
            }
            return temperature
          },

          /**
           * 准备图表数据（高德API适配）
           */
          prepareChartData(data) {
            // 简化图表数据准备，只保留温度图表
            if (data.forecasts && data.forecasts.length > 0) {
              const forecastData = data.forecasts[0]
              this.chartData = {
                labels: forecastData.casts.slice(0, 4).map((cast) => new Date(cast.date).toLocaleDateString("zh-CN", { month: "short", day: "numeric" })),
                temps: forecastData.casts.slice(0, 4).map((cast) => Math.round((parseInt(cast.daytemp) + parseInt(cast.nighttemp)) / 2)),
              }
              this.createCharts()
            }
          },

          /**
           * 创建图表
           */
          createCharts() {
            // 延迟创建图表，确保DOM已渲染
            this.$nextTick(() => {
              // 温度图表
              if (this.tempChart) {
                this.tempChart.destroy()
              }

              const tempCtx = document.getElementById("tempChart")
              if (tempCtx) {
                this.tempChart = new Chart(tempCtx.getContext("2d"), {
                  type: "line",
                  data: {
                    labels: this.chartData.labels,
                    datasets: [
                      {
                        label: "温度 (°C)",
                        data: this.chartData.temps,
                        borderColor: "#FF9A8B",
                        backgroundColor: "rgba(255, 154, 139, 0.1)",
                        borderWidth: 3,
                        pointBackgroundColor: "#FF6B6B",
                        pointRadius: 5,
                        fill: true,
                        tension: 0.3,
                      },
                    ],
                  },
                  options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      legend: {
                        labels: { color: "rgba(255, 255, 255, 0.8)" },
                      },
                    },
                    scales: {
                      y: {
                        grid: { color: "rgba(255, 255, 255, 0.1)" },
                        ticks: { color: "rgba(255, 255, 255, 0.7)" },
                      },
                      x: {
                        grid: { color: "rgba(255, 255, 255, 0.1)" },
                        ticks: { color: "rgba(255, 255, 255, 0.7)" },
                      },
                    },
                  },
                })
              }
            })
          },

          /**
           * 更新背景
           */
          updateBackground() {
            if (!this.currentWeather) return

            // 移除所有天气类
            document.body.classList.remove("sunny", "cloudy", "rainy", "night")

            // 简化处理：根据天气文本设置背景
            const weather = this.currentWeather.text.toLowerCase()

            if (weather.includes("晴")) {
              document.body.classList.add("sunny")
            } else if (weather.includes("云") || weather.includes("阴") || weather.includes("雾")) {
              document.body.classList.add("cloudy")
            } else if (weather.includes("雨") || weather.includes("雪")) {
              document.body.classList.add("rainy")
            } else {
              // 默认使用基础背景
              document.body.classList.add("night")
            }
          },

          /**
           * 格式化日期
           */
          formatDate(dateString) {
            const date = new Date(dateString)
            return date.toLocaleDateString("zh-CN", { month: "short", day: "numeric" })
          },

          /**
           * 统一错误处理方法
           */
          handleError(context, error) {
            this.showError("获取天气数据失败")
          },

          /**
           * 显示错误消息
           */
          showError(message) {
            this.errorMessage = message
          },
        },

        /**
         * 生命周期钩子
         */
        mounted() {
          this.init()
        },

        /**
         * 组件销毁前清理图表
         */
        beforeDestroy() {
          if (this.tempChart) {
            this.tempChart.destroy()
          }
          if (this.precipChart) {
            this.precipChart.destroy()
          }
        },
      })
    </script>
  </body>
</html>
