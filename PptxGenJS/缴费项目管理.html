<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>缴费项目管理</title>
  
  <!-- Element UI 样式 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.15.13/lib/theme-chalk/index.css">
  <!-- Vue 2 -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
  <!-- Element UI 组件 -->
  <script src="https://cdn.jsdelivr.net/npm/element-ui@2.15.13/lib/index.js"></script>
</head>
<body>
  <div id="app" class="fee-project-management">
    <!-- 顶部栏 -->
    <div class="header">
      <div class="header-content">
        <h2>缴费项目管理</h2>
        <p class="description">管理学校收费项目设置</p>
      </div>
      <el-button type="primary" @click="openAddDialog">+ 添加收费项目</el-button>
    </div>

    <!-- 搜索区域 -->
    <div class="search-bar">
      <el-input 
        v-model="searchKeyword" 
        placeholder="搜索收费项目..." 
        prefix-icon="el-icon-search"
        style="width: 300px;"
      ></el-input>
    </div>

    <!-- 收费项目表格（带总计行） -->
    <el-table 
      :data="filteredTableData" 
      border 
      stripe 
      style="width: 100%; margin-top: 20px;"
      :summary-method="getSummary" 
      show-summary
      :header-cell-style="{ background: '#f5f7fa', fontWeight: 'bold' }"
    >
      <!-- 项目代码 -->
      <el-table-column prop="code" label="项目代码" width="120"></el-table-column>
      <!-- 项目名称 -->
      <el-table-column prop="name" label="项目名称" width="180"></el-table-column>
      <!-- 金额（格式化显示） -->
      <el-table-column prop="amount" label="金额" width="120">
        <template slot-scope="scope">
          {{ formatAmount(scope.row.amount) }}
        </template>
      </el-table-column>
      <!-- 是否必填（状态标签） -->
      <el-table-column prop="isRequired" label="是否必填" width="100">
        <template slot-scope="scope">
          <el-tag 
            :type="scope.row.isRequired ? 'success' : 'default'"
            size="small"
          >{{ scope.row.isRequired ? '是' : '否' }}</el-tag>
        </template>
      </el-table-column>
      <!-- 适用范围（多选项合并） -->
      <el-table-column prop="scope" label="适用范围"></el-table-column>
      <!-- 更新日期 -->
      <el-table-column prop="updateDate" label="更新日期" width="120"></el-table-column>
      <!-- 操作（固定列） -->
      <el-table-column label="操作" width="140" fixed="right">
        <template slot-scope="scope">
          <el-button 
            type="text" 
            icon="el-icon-edit" 
            @click="openEditDialog(scope.row)"
            size="small"
            class="edit-btn"
          >编辑</el-button>
          <el-button 
            type="text" 
            icon="el-icon-delete" 
            @click="deleteItem(scope.row)"
            size="small"
            class="delete-btn"
          >删除</el-button>
        </template>
      </el-table-column>
    </el-table>

    <!-- 添加/编辑对话框（复用） -->
    <el-dialog 
      :title="form.id ? '编辑收费项目' : '添加收费项目'" 
      :visible.sync="dialogVisible" 
      width="50%"
      :before-close="closeDialog"
    >
      <el-form 
        :model="form" 
        ref="form" 
        label-width="120px" 
        style="margin-top: 20px;"
      >
        <!-- 项目代码 -->
        <el-form-item 
          label="项目代码" 
          prop="code" 
          :rules="{ required: true, message: '请输入项目代码', trigger: 'blur' }"
        >
          <el-input v-model="form.code" placeholder="如：TUITION"></el-input>
        </el-form-item>
        <!-- 项目名称 -->
        <el-form-item 
          label="项目名称" 
          prop="name" 
          :rules="{ required: true, message: '请输入项目名称', trigger: 'blur' }"
        >
          <el-input v-model="form.name" placeholder="如：学费"></el-input>
        </el-form-item>
        <!-- 金额（数字输入，保留两位小数） -->
        <el-form-item 
          label="金额" 
          prop="amount" 
          :rules="[
            { required: true, message: '请输入金额', trigger: 'blur' },
            { type: 'number', min: 0.01, message: '金额不能小于0.01', trigger: 'blur' }
          ]"
        >
          <el-input-number 
            v-model="form.amount" 
            :min="0.01" 
            :step="0.01" 
            precision="2" 
            placeholder="请输入金额"
          ></el-input-number>
        </el-form-item>
        <!-- 是否必填（开关） -->
        <el-form-item label="是否必填" prop="isRequired">
          <el-switch 
            v-model="form.isRequired" 
            active-text="是" 
            inactive-text="否"
          ></el-switch>
        </el-form-item>
        <!-- 适用范围（多选下拉） -->
        <el-form-item 
          label="适用范围" 
          prop="scope" 
          :rules="{ required: true, message: '请选择适用范围', trigger: 'change' }"
        >
          <el-select 
            v-model="form.scope" 
            multiple 
            collapse-tags 
            placeholder="请选择适用范围"
            style="width: 100%;"
          >
            <el-option label="所有专业" value="所有专业"></el-option>
            <el-option label="计算机应用技术" value="计算机应用技术"></el-option>
            <el-option label="软件工程" value="软件工程"></el-option>
            <el-option label="机电一体化技术" value="机电一体化技术"></el-option>
          </el-select>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="closeDialog">取消</el-button>
        <el-button type="primary" @click="saveForm">确定</el-button>
      </div>
    </el-dialog>
  </div>

  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          // 搜索关键词
          searchKeyword: '',
          // 收费项目数据（模拟接口返回）
          tableData: [
            {
              id: 1,
              code: 'TUITION',
              name: '学费',
              amount: 5800.00,
              isRequired: true,
              scope: '所有专业',
              updateDate: '2025-01-10'
            },
            {
              id: 2,
              code: 'ACCOMMODATION',
              name: '住宿费',
              amount: 1200.00,
              isRequired: false,
              scope: '所有专业',
              updateDate: '2025-01-10'
            },
            {
              id: 3,
              code: 'TEXTBOOKS',
              name: '教材费',
              amount: 500.00,
              isRequired: true,
              scope: '所有专业',
              updateDate: '2025-03-15'
            },
            {
              id: 4,
              code: 'COMPUTER',
              name: '计算机设备费',
              amount: 800.00,
              isRequired: true,
              scope: '计算机应用技术, 软件工程',
              updateDate: '2025-01-15'
            },
            {
              id: 5,
              code: 'MATERIALS',
              name: '实训材料费',
              amount: 600.00,
              isRequired: true,
              scope: '机电一体化技术',
              updateDate: '2025-02-20'
            }
          ],
          // 对话框状态
          dialogVisible: false,
          // 表单数据（添加/编辑复用）
          form: {
            id: null,
            code: '',
            name: '',
            amount: 0.00,
            isRequired: false,
            scope: []
          }
        }
      },
      computed: {
        // 过滤后的表格数据（实时匹配搜索关键词）
        filteredTableData() {
          const keyword = this.searchKeyword.toLowerCase();
          return this.tableData.filter(item => 
            item.name.toLowerCase().includes(keyword) || 
            item.code.toLowerCase().includes(keyword)
          );
        }
      },
      methods: {
        // 格式化金额（¥xxx.00）
        formatAmount(amount) {
          return `¥${amount.toFixed(2)}`;
        },
        // 生成总计行（Element UI 表格内置方法）
        getSummary({ data }) {
          const summary = [];
          summary.push({
            // 合并项目代码列（显示“总计”）
            code: '总计',
            // 计算金额总和（保留两位小数）
            amount: data.reduce((sum, item) => sum + item.amount, 0).toFixed(2),
            // 其他列为空（不显示）
            name: '',
            isRequired: '',
            scope: '',
            updateDate: ''
          });
          return summary;
        },
        // 打开添加对话框
        openAddDialog() {
          this.dialogVisible = true;
          this.form = { id: null, isRequired: false, scope: [] }; // 重置表单
          this.$nextTick(() => this.$refs.form.resetFields()); // 重置表单校验
        },
        // 打开编辑对话框（填充当前行数据）
        openEditDialog(row) {
          this.dialogVisible = true;
          // 拷贝行数据（避免直接修改原始数据）
          this.form = { ...row, scope: row.scope.split(', ') }; // 适用范围转数组（用于多选框）
        },
        // 关闭对话框
        closeDialog() {
          this.dialogVisible = false;
          this.$refs.form.resetFields(); // 重置表单校验
        },
        // 保存表单（添加/编辑复用）
        saveForm() {
          this.$refs.form.validate(valid => {
            if (valid) {
              // 处理适用范围（数组转逗号分隔字符串）
              const formData = { ...this.form, scope: this.form.scope.join(', ') };
              if (formData.id) {
                // 编辑操作：更新原始数据
                const index = this.tableData.findIndex(item => item.id === formData.id);
                this.tableData.splice(index, 1, formData);
                this.$message.success('编辑成功');
              } else {
                // 添加操作：生成新ID（模拟）
                formData.id = this.tableData.length + 1;
                formData.updateDate = new Date().toISOString().slice(0, 10); // 模拟更新日期
                this.tableData.push(formData);
                this.$message.success('添加成功');
              }
              this.closeDialog(); // 关闭对话框
            }
          });
        },
        // 删除项目（确认提示）
        deleteItem(row) {
          this.$confirm(`确定删除项目「${row.name}」？`, '警告', {
            type: 'warning',
            confirmButtonText: '确定',
            cancelButtonText: '取消'
          }).then(() => {
            this.tableData = this.tableData.filter(item => item.id !== row.id);
            this.$message.success('删除成功');
          }).catch(() => {
            this.$message.info('取消删除');
          });
        }
      }
    });
  </script>

  <style>
    .fee-project-management {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    /* 顶部栏样式 */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .header h2 {
      margin: 0;
      font-size: 20px;
    }
    .header .description {
      margin: 5px 0 0 0;
      font-size: 14px;
      color: #666;
    }
    /* 搜索栏样式 */
    .search-bar {
      margin-bottom: 20px;
    }
    /* 操作按钮样式 */
    .edit-btn {
      color: #409EFF; /* 编辑按钮蓝色 */
    }
    .delete-btn {
      color: #FF4949; /* 删除按钮红色 */
    }
    /* 对话框底部样式 */
    .dialog-footer {
      text-align: right;
    }
    /* 总计行样式（加粗） */
    .el-table__footer-wrapper .el-table__row {
      font-weight: bold;
    }
  </style>
</body>
</html>